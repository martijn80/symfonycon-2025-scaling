{
	admin 0.0.0.0:2019
	metrics
	auto_https off

	frankenphp {
		num_threads 20 # Optimal: 16 workers + 4 handling threads
		max_threads auto # Keep stable, no dynamic scaling

		worker {
			watch

			file ./public/index.php
			num 16 # 2 workers per CPU core (8 cores * 2) - optimal balance
		}

		php_ini {
			opcache.enable 0
			opcache.validate_timestamps 1
		}
	}
}

{$SERVER_NAME::80} {
	root {$SERVER_ROOT:public/}
	encode zstd br gzip 

	{$CADDY_SERVER_EXTRA_DIRECTIVES}

	php_server
}
